# 萌股版本开发流程

以版本 3.1.0为例

## 需求评审阶段

1. 各开发小组组长和产品确定版本的功能内容
2. 需求评审, 确定版本号
3. 开发测试人员排期, 确定工时, 同产品商议需求删减, 确定封包时间

分支管理:
各部门组长从 master 分支上, 切出版本分支 feature - 3.1.0
feature - 3.1.0, 为本次版本的主要分支, 各开发人员主要在该分支上进行操作.

## 开发+功能测试阶段

1. 测试人员, 编写测试用例. 开发人员, 按照自己承担的功能从版本分支上切出各自的功能分支. 在划分功能时, 尽量做到功能独立. 

分支管理: 
开发人员, 从版本分支 feature - 3.1.0 切出各自的功能分支, 以功能名和名称命名.
例: vip帖子气泡修改功能, 刘国强从 feature - 3.1.0 切出 feature-bubble-lgq 分支.

2. 开发完成后, 开发人员充分自测后, 部门人员相互进行 CodeReview 后合并到版本分支.

分支管理:
由部门组长合并功能分支 feature-bubble-lgq 到 版本分支 feature - 3.1.0.

3. 功能分支合并到版本分支后, 就进入单个功能测试阶段. 由部门组长合并版本分支到 develop 分支, 打包交付测试人员测试.

分支管理: 
部门组长合并版本分支 feature - 3.1.0 到 develop 分支: 前端进行打包, 后端部署到测试环境.

4. bug 修复. 测试人员测出问题来, 开发人员在版本分支 feature - 3.1.0 上进行修复, 每日部门组长进行打包, 测试环境部署工作.
开发人员同时进行下一功能开发和上一功能的 bug 修复工作. 一般一个版本, 主要开发人员会承担多个功能, 一般开发人员 1-2 个功能.

分支管理: 
由部门组长合并版本分支 feature - 3.1.0 到 develop 分支, 前端进行打包, 后端部署到测试环境.

## 综合测试

当所有功能开发完毕之后, 所有的功能分支都合并到版本分支 feature - 3.1.0, 测试人员测试所有功能, 功能之间交互, 和回归测试. 一般为 2-3 天. 

分支管理: 
由部门组长合并版本分支 feature - 3.1.0 到 develop 分支, 前端进行打包, 后端部署到测试环境. 

在测试人员测试完成后, 测试组长发送测试通报, 交付产品, 运营人员验收. 时间一般为 1 天. 验收过程产生的问题, 当天解决.
产品运营验收通过之后, iOS 会进行提审工作, iOS 审核一般需要 2 天, 在审核通过后同运营人员确定发版时间.

## 发版过程

### 发版前

后端: 
3.1.0 版本的所有功能都在版本分支 feature - 3.1.0 上, 但是由于后端经常有热修, 需要拉取 master 分支的代码同步到版本分支上, 解决冲突. 解决冲突之后, 版本分支 feature - 3.1.0 待到发版时间点, 合并到 master 分支.
负责发版的主要人员, 会书写发版流程清单, 详细描述整个发版过程. 
例: http://wiki.mocaapp.cn/pages/viewpage.action?pageId=7569595

移动端:
3.1.0 版本的所有功能都在版本分支 feature - 3.1.0 上, 移动端除非有紧急 bug 需要发版, 一般上个版本发现 bug 会随着新版本解决.
移动端将版本分支 feature - 3.1.0 合并到 release 分支. 在 release 分支上, 专门处理提审阶段的问题, 一般为 iOS 审核时出现的问题. 

### 发版时

发版时, 版本负责人需要提前进行钉钉上线申请, 通知产品, 运维, 和项目负责人.
后端 feature - 3.1.0 分支代码会在预发布环境进行部署, 预发布环境为 https://app.moego.net:4000.
测试人员在预发布环境, 进行整体的功能测试, 并检查原有功能可用性.
预发布测试通过后, 代码会部署到正式环境, 正式环境测试完成后, 发版结束.
具体过程详见上线清单.
移动端会在后端代码上线后, 打开各个应用商店的下载入口.

### 发版后

发版后, 后端 feature - 3.1.0 已经合并到 master, 移动端后在发版结束后, 将 release 合并到 master.

## 热修

当发生了线上问题时:

后端:
从 master 拉取热修分支, 以 hotfix-功能-姓名 命名, 测试, Review 之后, 直接合并到 master 进行上线.
由于后端热修频繁, master 分支的内容, 会与版本分支 feature - 3.1.0 诸多不同步, 需要专门在新版本发版前进行合并, 解决冲突.
目前上线窗口时间点为: 周一到周五 9:00 - 16:00.
上线窗口时间点, 钉钉提交上线申请, 由开发小组负责人审核.
尽量控制不要在非上线窗口时间点上线, 如果需要紧急上线, 钉钉提交上线申请, 由项目负责人审核.

移动端:
移动端没有热修功能, 原有热修功能, 各应用商店都已明令禁止使用.
如果发生了严重问题, 需要发版解决. 移动端从 master 切出新版本分支进行修复, 例如 feature - 3.0.1, 在该版本上只进行严重问题的修复, 测试 Review 之后, 合并到 release 分支进行提审. 发版后合并 release 分支到 master.
因为修复版本改动一般很小, 在功能开发阶段, 部门组长会将修复内容从 master 合并到版本分支 feature - 3.1.0.

## Web

H5 相关需求一直不太多, 过程类似于移动端, 不过没有 release 分支和提审过程. 
