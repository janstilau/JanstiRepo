# 确保 web 安全的 https

## Http 的问题

### 通信使用明文(不加密), 内容可能会被窃听

由于 TPC/IP 的协议族的工作机制, 通信的内容在所有的通信线路上都有可能遭到窥视.

未经过加密的信息直接可以被人窃取, 而加密的信息是为了让窃取的人得不到原始信息. 在网络上, 信息总是可以被人截获的.

* 通信的加密

用 SSL(Secure socket layer) 建立安全通信线路后, 在这条线路上进行 http 的通信.

* 内容的加密

对 http 的报文进行加密.

### 不验证通信方的身份, 可能遭遇伪装

http 的本身是没有验证机制的, 无论是谁发送的请求都会相应.

* 无法确定 web 服务器是不是真实的, 可能是伪装的
* 无法确定客户端是不是真实的, 可能是伪装的
* 无法判断请求用户的权限
* 无法判断请求的来源
* dos攻击

对于用户验证, 可以在 http 的报文上加上用户信息和一些验证机制. 对于服务器的验证, 可以通过证书的方式.

### 无法证明报文的完整性, 可能被篡改

散列算法, 计算出散列值来, 随着数据发送. 用户在接收到数据后, 计算数据的散列值, 和发送过来的散列值比对.

但是实际上, 如果有中间人攻击, 它可以重新计算散列值并发送过来, 所以仅靠 http 无法确保报文的完整性.

## Https = http + 加密 + 认证 + 完整性保护.

* 对称加密算法的问题

对称加密算法, 需要将秘钥进行传输, A -> B, 那么 A 需要先把秘钥给 B , 而运输的过程, 秘钥可能就被他人截获了.

* 非对称加密算法

公钥私钥一起使用. 公钥可以暴露给对方, 对方用公钥加密, 想要获取原始信息, 只能用私钥解密.

* Https 使用 对称加密算法 + 非对称加密算法

首先用非对称加密算法传送对称加密算法的秘钥, 然后用对称加密算法加密, 因为对称加密算法的速度要快很多.

* 证书的作用

非对称加密算法的问题在于, 公钥可能是假的. 而证书则是为了证明公钥是真的. 证书颁发机构的公钥是存储在浏览器或者硬件设备上的, 然后颁发机构用自己的私钥对申请者的公钥签名. 用户拿到证书之后, 取得里面的公钥信息, 计算出散列值, 然后用颁发机构的公钥解密签名, 如果两个值相等, 就认为证书里面的公钥是真实的服务器公钥.

## Https 的通信过程

1. 客户端和服务器建立 SSL 链接
1. 服务器发送证书过来
1. 客户端在通过证书验证后, 用证书里面的公钥加密对称加密算法的密钥给服务器
1. 之后的通信就用这个对称加密算法的密钥进行加密
1. 断开链接.