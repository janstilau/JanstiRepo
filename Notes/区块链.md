# BlockChain

## 区块链和去中心化

* 电影下载 ex.
  * 电影网站下载, 中心化.
  * p2p 软件下载, 去中心化.

* money
  * 人民币, 中心化, 所有的一切都是央行控制
  * 比特币. 第一，它的货币发行不是由某个机构说了算，而是公开一套算法，每算出一个符合要求的数字，就相当于挖到了若干个比特币。谁都可以去算，绝对公平，谁也作不了弊，因为算法本质上就是一个个数字去凑，凑出一个算一个。第二，比特币的交易信息不是记在某一台服务器上的，而是所有参与这个游戏的玩家电脑中一人一份，同步记录，这种交易记录在理论上几乎是无法篡改的。

## 比特币的缺陷

1. 比特币客户端软件需要巨大无比的存储空间，因为每一个节点都必须记录下从比特币系统诞生的第一天起所有的交易记录，截止到本文写作时（2018年2月13日），这个交易记录文件已经有147GB那么大了，而且只会增加不会减少。
1. 为防止有人作弊，比特币系统有一套很复杂的游戏规则来确保交易记录是真实的，这样就导致每一笔交易的确认时间一般需要一个小时甚至几天
1. 最多只有2100万枚比特币，而且，无论有多少人在挖矿，系统规则决定了平均每十分钟才能产出若干枚比特币

## 比特币不能代表区块链，区块链也不是比特币

区块链解决的核心问题是信任问题。所有的金融机构，银行、保险、券商等等，让它们赖以生存的根本是信用，我们之所以会放心地买股票、买期货、买纸黄金，都是因为我们信任充当交易中介的机构，而这些交易中介，就是金融活动的中心，我们宁愿为此付出一定的手续费、交易费，金融机构也因此挣得盆满钵满。

当区块链在人们的观念上和技术上都成熟后，这种中心化的金融机构是有可能被颠覆掉的，因为我们可以利用区块链的理念和技术来改写游戏规则，让所有的金融产品交易都不再需要一个中心，而全部以点对点的方式完成，并且从理论上能够保证信用问题.

## 比特币的原理

* 哈希算法

请设计一个算法，将任何一条信息，不论长短，都计算出一个唯一的“数字指纹”与它对应。但有两个附加条件：一、指纹的长度必须固定；二、只能从“原始信息”计算出“指纹”，谁也无法从“指纹”反向计算出“原始信息”。

算法的特点: 一、原始信息只要改变一点点，哪怕只改动一个数字，整个指纹就会发生巨大的变化，毫无规律可循；二、截至本文写作时，世界上还没有任何公开的方法可以从指纹反向计算出原始信息，普遍认为理论上无法破解。

数字签名: 发送原始内容, 以及对原始内容进行的哈希摘要. 当接受者收到信息之后, 用公开的算法对内容进行哈希, 然后和发送过来的签名进行比对, 如果发现不一致, 就证明内容被修改了. 数字签名只能解决内容的完整性问题.

* 对称加密算法

加密和解密的算法是逆向的, 知道了怎么加密, 就知道了怎么解密.

* 非对称加密

加密的算法, 和解密的算法是分开的, 解密的算法无法推导出加密算法.

### 公钥加密, 私钥解密

用公钥加密, 为的是内容保密. 用公钥加密的内容, 只能由私钥进行解密, 通过这种方式, 能够让信息隐藏.

### 私钥签名, 公钥验证

公钥加密并不能解决身份问题, A -> C, B 也可以用 C 的公钥进行加密发送给 C. 那么需要一种方式证明, 发送者是 A. A 也有一堆私钥公钥, 用哈希算法, 计算 C 的公钥加密好的信息, 然后用 A 的私钥进行加密, 和原始信息一起发送给 C. C 由 A 的公钥, 用 A 的公钥解密, 然后对原始信息进行哈希, 比对两者是否相等. 这个时候, B 如果发送假信息给 C, 但是没有 A 的私钥, 那么 C 用 A 的公钥解出来的值, 就和内容的哈希值不相等, 这样就认定不是 A 发送的信息.

从上面可以看出, 真正的数据实际上是 数据用对方公钥加密, 加密后摘要, 然后用自己私钥对摘要加密. 这里的摘要起什么作用呢. 原始内容可以推导出摘要, 算法是公开了. 虽然会有哈希碰撞, 但是成熟的摘要算法可以认为原始内容可以和摘要可以一一对应.

对于上面的验证过程, A 可不可以用 A 的私钥加密整个加密数据, 拼接到原始加密数据后, 然后发送出去呢. C 拿到数据后, 用 A 的公钥解密后面的拼接数据, 然后和第一部分数据比对, 也可以完成验证. 也就是说, 验证用户这件事和数字签名是没有关系的, 数字签名做的就是验证内容的完整性. 而用私钥加密, 将私钥加密的内容附在原始内容后面,公钥解密私钥加密的内容和原始内容比对, 这是是为了验证用户的有效性. 但是因为哈希值和原始值可以近乎认为是一一对应的, 所以可以用哈希值作为原始内容的替换.

所以, 公钥加密私钥解密是为了隐藏内容, 私钥加密公钥解密是为了验证用户, 而哈希算法可以使得摘要和原始内容一一对应. 而数字签名, 其实是数字摘要和非对称加密的混合使用.[数字签名](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature)

### 一个私钥, 可以对应多个公钥

比特币中, 没有账户. 一个公钥, 就是一个账户, 而一个私钥, 可以生成多个账户, 所以拥有私钥的人, 就是那些账户真正的户主.

### 去中心化

区块链最重要的是解决了信息的同步和解决了重复问题.

比特币网络中的所有电脑都只认可唯一的一个账本，任何一台电脑在接入比特币网络时，首先要同步这个唯一的账本，任何一台电脑想要往这个账本上写入新的信息，必须完成一套繁琐的“手续”，这套手续复杂到几乎不太可能被同时完成两次，即便真的发生了巧合，被同时完成了两次甚至多次，也有一个规则可以判定哪条信息是合法的，哪条信息该被抛弃。

账本设计成了由一个个“信息包”首尾相连而成的长链，每一个信息包被称为一个“区块”，这些区块每一个都有唯一的编号——在比特币系统中，编号被称为高度（height），这些编号就是自然数1、2、3、4……一直往下排，不允许跳跃，也不允许中断和重复。

从第二个区块开始，以后每个区块就必须严格按照比特币系统的规则来创建了.

区块的规则有: 前一个区块的数字指纹, 固定信息, 交易记录, 随机数. 并且这个新区块的数字指纹（一个256位的二进制数）的前72位必须全部为0. 因为SHA算出来的指纹是毫无规律可循的一组数字，所以，想要满足中本聪的这个变态规定，唯一的办法就只能凭运气凑奥数，从0开始不断地去尝试，直到满足要求为止。因为每一个区块的字符串都不同，所以，每一次寻找奥数都需要从0开始，任何一个数字都有可能成为新的奥数，完全没有规律可循。一旦成功找到一个奥数，就获得了一次记账权力，可以给账本上新增加一个区块。

比特币系统规定，每成功增加一个区块，这台记账的电脑（实际上是某个账号）就能获得12.5个比特币的奖励（截止到本文写作时的奖金额），以及这个区块中所有交易的手续费，总额取决于交易频繁程度（平均约2比特币）。寻找奥数就是抢记账权，抢记账权也就是挖比特币。

正因为奥数太难找，每个区块平均要10分钟才能生成一个, 所以在一个机器记账之后, 有着足够的时间将信息同步到别的区块去. 但是确实有可能同时有两个机器算出奥数来, 就能够同时记账. 而比特币的账本是唯一的, 这样就产生了分支.

比特币规定, 先收到的账本优先取用, 放弃后收到的, 也就是说, 一个新的机器要记账的时候, 按照第一个收到的账本为准. 但是确实有别的机器收到的是另外一个账本, 没有关系, 另一个机器就在另一个账本记账. 而之后收到账本的机器, 以长的账本为准, 放弃短的. 原则就是保留长的, 放弃短的, 一样长就保留, 直到得到更长的信息. 所以交易要等一段时间才能确保成功与否, 因为有可能自己的交易最终被放弃了.


## 比特币的交易过程

### 交易记录

一个交易记录里面以下信息:

* 交易金额
* 上一笔交易的 hash (确保比特币来源)
* 本次交易双方的地址
* 支付方的公钥
* 支付方私钥生成的数字签名 (确保用户身份)

所以, 一个交易记录主要是用加密技术保证了交易的内容的真实.

### 区块

一个区块里面里面包含了2000多条记录, 而将区块写入账本的过程, 是矿工做的, 矿工要计算出符合条件的 nonce 值, 然后将块写入账本. 而只要写入账本之后, 因为所有的交易信息都会同步到他人的账本上, 所以没有办法反悔了.

## 区块链为什么难以篡改

1. 所有的信息都在各个客户端上, 没有办法修改每个人的信息
1. 修改一个值, 就会因为修改的区块的数字签名, 而后一个区块后记录上一个区块的数字签名, 也就是说, 修改了第一个块之后, 要修改第二个块的记录的第一个块数字签名, 才能形成链条, 而修改第二个块的值, 会导致第二个块的数值改变, 那么第二个块的数字签名也就改变了, 就导致了第三个块的要修改记录的第二个块的数字签名. 这样连续下去, 为了让这个账本之后的节点能后挂钩到修改了的区块, 要修改后面所有区块的内容, 这个难度太大了.

## 去中心化的代价

之前的机器性能, 硬盘价格, 网络条件, 都是制约这种技术的原因. 之前的中心化, 有着一个很大的特点, 就是节约资源. 现在去中心化是要求所有的资源要在所有的机器上有个拷贝, 加大了篡改的难度, 但是代价是, 这个世界有多少比特币客户端, 那么就有多少机器记录了完全相同的数据.

[区块链入门教程-阮一峰](http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html)
[长文解惑：区块链与比特币-读库](https://mp.weixin.qq.com/s?__biz=MjM5OTM4MDY4MQ%3D%3D&mid=2650107480&idx=1&sn=3f6d6ceebb58887577484a84c22c5925&scene=45#wechat_redirect)